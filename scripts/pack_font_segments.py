#!/usr/bin/env python3
"""
Generate packed u32 font segment data from original VecSeg coordinates.
Each segment packs 4 floats (p0.x, p0.y, p1.x, p1.y) into one u32.
"""

# Original font segment data (160 segments)
segments = [
    # '0' (5 segments)
    (0.2,0.0, 0.8,0.0), (0.8,0.0, 0.8,1.0), (0.8,1.0, 0.2,1.0), (0.2,1.0, 0.2,0.0), (0.2,0.0, 0.8,1.0),
    # '1' (2 segments)
    (0.5,0.0, 0.5,1.0), (0.5,1.0, 0.3,0.8),
    # '2' (5 segments)
    (0.2,1.0, 0.8,1.0), (0.8,1.0, 0.8,0.5), (0.8,0.5, 0.2,0.5), (0.2,0.5, 0.2,0.0), (0.2,0.0, 0.8,0.0),
    # '3' (4 segments)
    (0.2,1.0, 0.8,1.0), (0.8,1.0, 0.8,0.0), (0.8,0.0, 0.2,0.0), (0.8,0.5, 0.4,0.5),
    # '4' (3 segments)
    (0.2,1.0, 0.2,0.4), (0.2,0.4, 0.8,0.4), (0.7,0.0, 0.7,1.0),
    # '5' (5 segments)
    (0.8,1.0, 0.2,1.0), (0.2,1.0, 0.2,0.5), (0.2,0.5, 0.8,0.5), (0.8,0.5, 0.8,0.0), (0.8,0.0, 0.2,0.0),
    # '6' (5 segments)
    (0.8,1.0, 0.2,1.0), (0.2,1.0, 0.2,0.0), (0.2,0.0, 0.8,0.0), (0.8,0.0, 0.8,0.5), (0.8,0.5, 0.2,0.5),
    # '7' (2 segments)
    (0.2,1.0, 0.8,1.0), (0.8,1.0, 0.4,0.0),
    # '8' (5 segments)
    (0.2,0.0, 0.8,0.0), (0.8,0.0, 0.8,1.0), (0.8,1.0, 0.2,1.0), (0.2,1.0, 0.2,0.0), (0.2,0.5, 0.8,0.5),
    # '9' (5 segments)
    (0.8,0.5, 0.2,0.5), (0.2,0.5, 0.2,1.0), (0.2,1.0, 0.8,1.0), (0.8,1.0, 0.8,0.0), (0.8,0.0, 0.2,0.0),
    # 'A' (3 segments)
    (0.1,0.0, 0.5,1.0), (0.5,1.0, 0.9,0.0), (0.25,0.4, 0.75,0.4),
    # 'B' (8 segments)
    (0.2,0.0, 0.2,1.0), (0.2,1.0, 0.7,1.0), (0.7,1.0, 0.8,0.75), (0.8,0.75, 0.7,0.5),
    (0.7,0.5, 0.2,0.5), (0.7,0.5, 0.8,0.25), (0.8,0.25, 0.7,0.0), (0.7,0.0, 0.2,0.0),
    # 'C' (3 segments)
    (0.8,1.0, 0.2,1.0), (0.2,1.0, 0.2,0.0), (0.2,0.0, 0.8,0.0),
    # 'D' (6 segments)
    (0.2,0.0, 0.2,1.0), (0.2,1.0, 0.6,1.0), (0.6,1.0, 0.8,0.8), (0.8,0.8, 0.8,0.2), (0.8,0.2, 0.6,0.0), (0.6,0.0, 0.2,0.0),
    # 'E' (4 segments)
    (0.8,1.0, 0.2,1.0), (0.2,1.0, 0.2,0.0), (0.2,0.5, 0.7,0.5), (0.2,0.0, 0.8,0.0),
    # 'F' (3 segments)
    (0.2,0.0, 0.2,1.0), (0.2,1.0, 0.8,1.0), (0.2,0.5, 0.7,0.5),
    # 'G' (5 segments)
    (0.8,1.0, 0.2,1.0), (0.2,1.0, 0.2,0.0), (0.2,0.0, 0.8,0.0), (0.8,0.0, 0.8,0.5), (0.8,0.5, 0.5,0.5),
    # 'H' (3 segments)
    (0.2,0.0, 0.2,1.0), (0.8,0.0, 0.8,1.0), (0.2,0.5, 0.8,0.5),
    # 'I' (3 segments)
    (0.5,0.0, 0.5,1.0), (0.3,0.0, 0.7,0.0), (0.3,1.0, 0.7,1.0),
    # 'J' (3 segments)
    (0.6,1.0, 0.6,0.2), (0.6,0.2, 0.4,0.0), (0.4,0.0, 0.2,0.2),
    # 'K' (3 segments)
    (0.2,0.0, 0.2,1.0), (0.8,1.0, 0.2,0.5), (0.2,0.5, 0.8,0.0),
    # 'L' (2 segments)
    (0.2,1.0, 0.2,0.0), (0.2,0.0, 0.8,0.0),
    # 'M' (4 segments)
    (0.1,0.0, 0.1,1.0), (0.1,1.0, 0.5,0.5), (0.5,0.5, 0.9,1.0), (0.9,1.0, 0.9,0.0),
    # 'N' (3 segments)
    (0.2,0.0, 0.2,1.0), (0.2,1.0, 0.8,0.0), (0.8,0.0, 0.8,1.0),
    # 'O' (4 segments)
    (0.2,0.0, 0.8,0.0), (0.8,0.0, 0.8,1.0), (0.8,1.0, 0.2,1.0), (0.2,1.0, 0.2,0.0),
    # 'P' (5 segments)
    (0.2,0.0, 0.2,1.0), (0.2,1.0, 0.7,1.0), (0.7,1.0, 0.8,0.75), (0.8,0.75, 0.7,0.5), (0.7,0.5, 0.2,0.5),
    # 'Q' (5 segments)
    (0.2,0.0, 0.8,0.0), (0.8,0.0, 0.8,1.0), (0.8,1.0, 0.2,1.0), (0.2,1.0, 0.2,0.0), (0.6,0.3, 0.9,-0.1),
    # 'R' (6 segments)
    (0.2,0.0, 0.2,1.0), (0.2,1.0, 0.7,1.0), (0.7,1.0, 0.8,0.75), (0.8,0.75, 0.7,0.5), (0.7,0.5, 0.2,0.5), (0.5,0.5, 0.8,0.0),
    # 'S' (5 segments)
    (0.8,1.0, 0.2,1.0), (0.2,1.0, 0.2,0.5), (0.2,0.5, 0.8,0.5), (0.8,0.5, 0.8,0.0), (0.8,0.0, 0.2,0.0),
    # 'T' (2 segments)
    (0.2,1.0, 0.8,1.0), (0.5,1.0, 0.5,0.0),
    # 'U' (5 segments)
    (0.2,1.0, 0.2,0.2), (0.2,0.2, 0.3,0.0), (0.3,0.0, 0.7,0.0), (0.7,0.0, 0.8,0.2), (0.8,0.2, 0.8,1.0),
    # 'V' (2 segments)
    (0.1,1.0, 0.5,0.0), (0.5,0.0, 0.9,1.0),
    # 'W' (4 segments)
    (0.1,1.0, 0.2,0.0), (0.2,0.0, 0.5,0.6), (0.5,0.6, 0.8,0.0), (0.8,0.0, 0.9,1.0),
    # 'X' (2 segments)
    (0.2,0.0, 0.8,1.0), (0.2,1.0, 0.8,0.0),
    # 'Y' (3 segments)
    (0.2,1.0, 0.5,0.5), (0.8,1.0, 0.5,0.5), (0.5,0.5, 0.5,0.0),
    # 'Z' (3 segments)
    (0.2,1.0, 0.8,1.0), (0.8,1.0, 0.2,0.0), (0.2,0.0, 0.8,0.0),
    # ' ' space (0 segments)
    # '.' period (2 segments)
    (0.45,0.0, 0.55,0.0), (0.45,0.05, 0.55,0.05),
    # ',' comma (1 segments)
    (0.5,0.0, 0.4,-0.2),
    # ':' colon (2 segments)
    (0.45,0.3, 0.55,0.3), (0.45,0.7, 0.55,0.7),
    # '-' dash (1 segments)
    (0.2,0.5, 0.8,0.5),
    # '+' plus (2 segments)
    (0.5,0.2, 0.5,0.8), (0.2,0.5, 0.8,0.5),
    # '=' equals (2 segments)
    (0.2,0.4, 0.8,0.4), (0.2,0.6, 0.8,0.6),
    # '%' percent (3 segments)
    (0.2,0.8, 0.3,0.9), (0.7,0.1, 0.8,0.2), (0.2,0.0, 0.8,1.0),
    # '(' left paren (3 segments)
    (0.6,1.0, 0.4,0.7), (0.4,0.7, 0.4,0.3), (0.4,0.3, 0.6,0.0),
    # ')' right paren (3 segments)
    (0.4,1.0, 0.6,0.7), (0.6,0.7, 0.6,0.3), (0.6,0.3, 0.4,0.0),
    # '/' slash (1 segments)
    (0.2,0.0, 0.8,1.0),
]

def pack_segment(p0x, p0y, p1x, p1y):
    """Pack 4 floats into a u32. Byte order: p0x | p0y << 8 | p1x << 16 | p1y << 24"""
    b0 = max(0, min(255, round(p0x * 255.0)))
    b1 = max(0, min(255, round(p0y * 255.0)))
    b2 = max(0, min(255, round(p1x * 255.0)))
    b3 = max(0, min(255, round(p1y * 255.0)))
    return (b3 << 24) | (b2 << 16) | (b1 << 8) | b0

# Generate packed data
packed = [pack_segment(*seg) for seg in segments]

# Output in WGSL format (8 values per line)
print("var<private> FONT_SEGMENTS: array<u32, 160> = array<u32, 160>(")
for i in range(0, len(packed), 8):
    line = packed[i:i+8]
    hex_values = ','.join(f'0x{v:08X}u' for v in line)
    suffix = ',' if i + 8 < len(packed) else ');'
    print(f"    {hex_values}{suffix}")

print(f"\n// Total segments: {len(packed)}")
print(f"// Verification - first segment (0.2,0.0,0.8,0.0): 0x{packed[0]:08X}u")
print(f"// Expected: p0x=51(0x33), p0y=0(0x00), p1x=204(0xCC), p1y=0(0x00) = 0x00CC0033")
