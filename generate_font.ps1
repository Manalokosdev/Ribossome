# Generate packed font segment data
$segments = @(
    # '0' (5 segments)
    @(0.2,0.0,0.8,0.0),@(0.8,0.0,0.8,1.0),@(0.8,1.0,0.2,1.0),@(0.2,1.0,0.2,0.0),@(0.2,0.0,0.8,1.0),
    # '1' (2 segments)
    @(0.5,0.0,0.5,1.0),@(0.5,1.0,0.3,0.8),
    # '2' (5 segments)
    @(0.2,1.0,0.8,1.0),@(0.8,1.0,0.8,0.5),@(0.8,0.5,0.2,0.5),@(0.2,0.5,0.2,0.0),@(0.2,0.0,0.8,0.0),
    # '3' (4 segments)
    @(0.2,1.0,0.8,1.0),@(0.8,1.0,0.8,0.0),@(0.8,0.0,0.2,0.0),@(0.8,0.5,0.4,0.5),
    # '4' (3 segments)
    @(0.2,1.0,0.2,0.4),@(0.2,0.4,0.8,0.4),@(0.7,0.0,0.7,1.0),
    # '5' (5 segments)
    @(0.8,1.0,0.2,1.0),@(0.2,1.0,0.2,0.5),@(0.2,0.5,0.8,0.5),@(0.8,0.5,0.8,0.0),@(0.8,0.0,0.2,0.0),
    # '6' (5 segments)
    @(0.8,1.0,0.2,1.0),@(0.2,1.0,0.2,0.0),@(0.2,0.0,0.8,0.0),@(0.8,0.0,0.8,0.5),@(0.8,0.5,0.2,0.5),
    # '7' (2 segments)
    @(0.2,1.0,0.8,1.0),@(0.8,1.0,0.4,0.0),
    # '8' (5 segments)
    @(0.2,0.0,0.8,0.0),@(0.8,0.0,0.8,1.0),@(0.8,1.0,0.2,1.0),@(0.2,1.0,0.2,0.0),@(0.2,0.5,0.8,0.5),
    # '9' (5 segments)
    @(0.8,0.5,0.2,0.5),@(0.2,0.5,0.2,1.0),@(0.2,1.0,0.8,1.0),@(0.8,1.0,0.8,0.0),@(0.8,0.0,0.2,0.0),
    # 'A' (3 segments)
    @(0.1,0.0,0.5,1.0),@(0.5,1.0,0.9,0.0),@(0.25,0.4,0.75,0.4),
    # 'B' (8 segments)
    @(0.2,0.0,0.2,1.0),@(0.2,1.0,0.7,1.0),@(0.7,1.0,0.8,0.75),@(0.8,0.75,0.7,0.5),
    @(0.7,0.5,0.2,0.5),@(0.7,0.5,0.8,0.25),@(0.8,0.25,0.7,0.0),@(0.7,0.0,0.2,0.0),
    # 'C' (3 segments)
    @(0.8,1.0,0.2,1.0),@(0.2,1.0,0.2,0.0),@(0.2,0.0,0.8,0.0),
    # 'D' (6 segments)
    @(0.2,0.0,0.2,1.0),@(0.2,1.0,0.6,1.0),@(0.6,1.0,0.8,0.8),@(0.8,0.8,0.8,0.2),@(0.8,0.2,0.6,0.0),@(0.6,0.0,0.2,0.0),
    # 'E' (4 segments)
    @(0.8,1.0,0.2,1.0),@(0.2,1.0,0.2,0.0),@(0.2,0.5,0.7,0.5),@(0.2,0.0,0.8,0.0),
    # 'F' (3 segments)
    @(0.2,0.0,0.2,1.0),@(0.2,1.0,0.8,1.0),@(0.2,0.5,0.7,0.5),
    # 'G' (5 segments)
    @(0.8,1.0,0.2,1.0),@(0.2,1.0,0.2,0.0),@(0.2,0.0,0.8,0.0),@(0.8,0.0,0.8,0.5),@(0.8,0.5,0.5,0.5),
    # 'H' (3 segments)
    @(0.2,0.0,0.2,1.0),@(0.8,0.0,0.8,1.0),@(0.2,0.5,0.8,0.5),
    # 'I' (3 segments)
    @(0.5,0.0,0.5,1.0),@(0.3,0.0,0.7,0.0),@(0.3,1.0,0.7,1.0),
    # 'J' (3 segments)
    @(0.6,1.0,0.6,0.2),@(0.6,0.2,0.4,0.0),@(0.4,0.0,0.2,0.2),
    # 'K' (3 segments)
    @(0.2,0.0,0.2,1.0),@(0.8,1.0,0.2,0.5),@(0.2,0.5,0.8,0.0),
    # 'L' (2 segments)
    @(0.2,1.0,0.2,0.0),@(0.2,0.0,0.8,0.0),
    # 'M' (4 segments)
    @(0.1,0.0,0.1,1.0),@(0.1,1.0,0.5,0.5),@(0.5,0.5,0.9,1.0),@(0.9,1.0,0.9,0.0),
    # 'N' (3 segments)
    @(0.2,0.0,0.2,1.0),@(0.2,1.0,0.8,0.0),@(0.8,0.0,0.8,1.0),
    # 'O' (4 segments)
    @(0.2,0.0,0.8,0.0),@(0.8,0.0,0.8,1.0),@(0.8,1.0,0.2,1.0),@(0.2,1.0,0.2,0.0),
    # 'P' (5 segments)
    @(0.2,0.0,0.2,1.0),@(0.2,1.0,0.7,1.0),@(0.7,1.0,0.8,0.75),@(0.8,0.75,0.7,0.5),@(0.7,0.5,0.2,0.5),
    # 'Q' (5 segments)
    @(0.2,0.0,0.8,0.0),@(0.8,0.0,0.8,1.0),@(0.8,1.0,0.2,1.0),@(0.2,1.0,0.2,0.0),@(0.6,0.3,0.9,-0.1),
    # 'R' (6 segments)
    @(0.2,0.0,0.2,1.0),@(0.2,1.0,0.7,1.0),@(0.7,1.0,0.8,0.75),@(0.8,0.75,0.7,0.5),@(0.7,0.5,0.2,0.5),@(0.5,0.5,0.8,0.0),
    # 'S' (5 segments)
    @(0.8,1.0,0.2,1.0),@(0.2,1.0,0.2,0.5),@(0.2,0.5,0.8,0.5),@(0.8,0.5,0.8,0.0),@(0.8,0.0,0.2,0.0),
    # 'T' (2 segments)
    @(0.2,1.0,0.8,1.0),@(0.5,1.0,0.5,0.0),
    # 'U' (5 segments)
    @(0.2,1.0,0.2,0.2),@(0.2,0.2,0.3,0.0),@(0.3,0.0,0.7,0.0),@(0.7,0.0,0.8,0.2),@(0.8,0.2,0.8,1.0),
    # 'V' (2 segments)
    @(0.1,1.0,0.5,0.0),@(0.5,0.0,0.9,1.0),
    # 'W' (4 segments)
    @(0.1,1.0,0.2,0.0),@(0.2,0.0,0.5,0.6),@(0.5,0.6,0.8,0.0),@(0.8,0.0,0.9,1.0),
    # 'X' (2 segments)
    @(0.2,0.0,0.8,1.0),@(0.2,1.0,0.8,0.0),
    # 'Y' (3 segments)
    @(0.2,1.0,0.5,0.5),@(0.8,1.0,0.5,0.5),@(0.5,0.5,0.5,0.0),
    # 'Z' (3 segments)
    @(0.2,1.0,0.8,1.0),@(0.8,1.0,0.2,0.0),@(0.2,0.0,0.8,0.0),
    # ' ' space (0 segments)
    # '.' period (2 segments)
    @(0.45,0.0,0.55,0.0),@(0.45,0.05,0.55,0.05),
    # ',' comma (1 segment)
    @(0.5,0.0,0.4,-0.2),
    # ':' colon (2 segments)
    @(0.45,0.3,0.55,0.3),@(0.45,0.7,0.55,0.7),
    # '-' dash (1 segment)
    @(0.2,0.5,0.8,0.5),
    # '+' plus (2 segments)
    @(0.5,0.2,0.5,0.8),@(0.2,0.5,0.8,0.5),
    # '=' equals (2 segments)
    @(0.2,0.4,0.8,0.4),@(0.2,0.6,0.8,0.6),
    # '%' percent (3 segments)
    @(0.2,0.8,0.3,0.9),@(0.7,0.1,0.8,0.2),@(0.2,0.0,0.8,1.0),
    # '(' left paren (3 segments)
    @(0.6,1.0,0.4,0.7),@(0.4,0.7,0.4,0.3),@(0.4,0.3,0.6,0.0),
    # ')' right paren (3 segments)
    @(0.4,1.0,0.6,0.7),@(0.6,0.7,0.6,0.3),@(0.6,0.3,0.4,0.0),
    # '/' slash (1 segment)
    @(0.2,0.0,0.8,1.0)
)

function Pack-Segment {
    param($p0x, $p0y, $p1x, $p1y)
    $b0 = [Math]::Max(0, [Math]::Min(255, [Math]::Round($p0x * 255)))
    $b1 = [Math]::Max(0, [Math]::Min(255, [Math]::Round($p0y * 255)))
    $b2 = [Math]::Max(0, [Math]::Min(255, [Math]::Round($p1x * 255)))
    $b3 = [Math]::Max(0, [Math]::Min(255, [Math]::Round($p1y * 255)))
    return (($b3 -shl 24) -bor ($b2 -shl 16) -bor ($b1 -shl 8) -bor $b0)
}

$packed = $segments | ForEach-Object { Pack-Segment $_[0] $_[1] $_[2] $_[3] }

Write-Host "var<private> FONT_SEGMENTS: array<u32, 160> = array<u32, 160>("
for ($i = 0; $i -lt $packed.Length; $i += 8) {
    $line = $packed[$i..[Math]::Min($i+7, $packed.Length-1)] | ForEach-Object { "0x{0:X8}u" -f $_ }
    $suffix = if ($i + 8 -lt $packed.Length) { "," } else { ");" }
    Write-Host ("    " + ($line -join ",") + $suffix)
}

Write-Host "`n// Total: $($packed.Length) segments"
Write-Host ("// First: 0x{0:X8}u (should be 0x00CC0033 for VecSeg(0.2,0.0,0.8,0.0))" -f $packed[0])
